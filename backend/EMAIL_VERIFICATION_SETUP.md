# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email Verification –¥–ª—è MyCloud

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `email_verification_tokens` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `email_verified` –∏ `verified_at` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
3. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `nodemailer`
4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã API endpoints –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
6. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —ç–∫—Ä–∞–Ω—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMTP –≤ .env —Ñ–∞–π–ª–µ

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª `/home/whoami/prj/MyCloudapp/backend/.env`:

```bash
# Email Configuration –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# Frontend URL –¥–ª—è deep links (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
FRONTEND_URL=mycloud://auth

# –ò–ª–∏ –µ—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –Ω–∞ web:
# FRONTEND_URL=http://localhost:8081/auth
```

## üîê –ü–æ–ª—É—á–µ–Ω–∏–µ App Password –¥–ª—è Gmail:

1. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π Google –∞–∫–∫–∞—É–Ω—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Account Security](https://myaccount.google.com/security)
3. –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞)
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "App passwords" (–ü–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
5. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "Mail"
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ `SMTP_PASS`

## üì± –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ SMTP —Å–µ—Ä–≤–∏—Å—ã:

### SendGrid
```bash
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASS=your-sendgrid-api-key
```

### Mailgun
```bash
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_USER=postmaster@your-domain.mailgun.org
SMTP_PASS=your-mailgun-password
```

### Mail.ru
```bash
SMTP_HOST=smtp.mail.ru
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=your-email@mail.ru
SMTP_PASS=your-password
```

### Yandex.Mail
```bash
SMTP_HOST=smtp.yandex.ru
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=your-email@yandex.ru
SMTP_PASS=your-password
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ .env:

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend —Å–µ—Ä–≤–µ—Ä:
```bash
cd /home/whoami/prj/MyCloudapp/backend
npm run dev
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (—Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç):
```bash
node -e "
const nodemailer = require('nodemailer');
require('dotenv').config();

const transporter = nodemailer.createTransporter({
  host: process.env.SMTP_HOST,
  port: process.env.SMTP_PORT,
  secure: process.env.SMTP_SECURE === 'true',
  auth: {
    user: process.env.SMTP_USER,
    pass: process.env.SMTP_PASS,
  },
});

transporter.verify((error, success) => {
  if (error) {
    console.log('‚ùå SMTP Error:', error);
  } else {
    console.log('‚úÖ SMTP Server is ready to send emails');
  }
});
"
```

## üìã API Endpoints

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email)
```
POST /api/auth/register
```

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
```
POST /api/auth/verify-email/confirm
Body: { "token": "verification-token" }
```

### –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞
```
POST /api/auth/verify-email/send
Headers: Authorization: Bearer <jwt-token>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```
GET /api/auth/verify-email/status
Headers: Authorization: Bearer <jwt-token>
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ —Å —Å—Å—ã–ª–∫–æ–π
3. **–≠–∫—Ä–∞–Ω "Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
4. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –ø–∏—Å—å–º–µ
5. **–≠–∫—Ä–∞–Ω "Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω"**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç**: –ß–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ª–æ–≥–∏–Ω

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- ‚úÖ –¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã —Ç–æ–ª—å–∫–æ 10 –º–∏–Ω—É—Ç
- ‚úÖ –¢–æ–∫–µ–Ω—ã –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ (–ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–º email –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏
- ‚úÖ Google OAuth –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞–µ—Ç email –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π
- ‚úÖ –°—Ç–∞—Ä—ã–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å —á–µ—Ä–µ–∑ cron job

## üêõ Troubleshooting:

### –ü–∏—Å—å–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
tail -f /home/whoami/prj/MyCloudapp/backend/logs/app.log

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
node -e "require('dotenv').config(); console.log('SMTP_HOST:', process.env.SMTP_HOST);"
```

### –û—à–∏–±–∫–∞ "Invalid credentials"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SMTP_USER –∏ SMTP_PASS
- –î–ª—è Gmail –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ App Password, –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ (–¥–ª—è Gmail)

### –ü–∏—Å—å–º–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–ø–∞–º
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SPF, DKIM, DMARC –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ SMTP —Å–µ—Ä–≤–∏—Å—ã (SendGrid, Mailgun)
- –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫

## üìù –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞ (–ø–æ–ª–Ω—ã–π)

```bash
# Server
PORT=5000
NODE_ENV=development

# Database
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your-db-password
DB_NAME=vps_billing
DB_PORT=3306

# JWT
JWT_SECRET=your-secret-key-here
JWT_EXPIRES_IN=7d

# Google OAuth
GOOGLE_CLIENT_ID=your-client-id
GOOGLE_CLIENT_SECRET=your-client-secret
GOOGLE_REDIRECT_URI=http://localhost:5000/api/auth/google/callback

# Email Verification (–î–û–ë–ê–í–¨–¢–ï –≠–¢–û!)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
FRONTEND_URL=mycloud://auth

# CORS
CORS_ORIGIN=http://localhost:3000,http://localhost:8081
```

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env —Ñ–∞–π–ª–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-01-28  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0

